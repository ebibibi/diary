---
title: "2012-03-26"
date: 2012-03-26
categories: 
  - "work"
---

今日の帰宅時間は午後11時過ぎ。今日も負けました。先週金曜日の非常に厳しい戦いの結果としてはほぼ勝利だったのですが、今日はまた別の問題が発生。あれよあれよという間に今日も遅くなってしまいました。今日は初めから遅くなる可能性を伝えてたあったけれども、娘が春休みで子供３人が１日中家にいる中で早く帰れないのは非常に残念。嫁さんにも苦労かけるし。ここのところ連敗続きです。本来の自分のポジションじゃないんだけど、やはり問題が起きたら正しく伝えて正しく解決に向かいたい。そう思ってでしゃばってしまいます。これではいかんのだろうな…。

今日学んだのはexchange2010のシャドウ冗長と遅延受信確認。

- [シャドウ冗長について: Exchange 2010 のヘルプ](http://technet.microsoft.com/ja-jp/library/dd351027.aspx)

- Exchange2010では送信先のホップのさらに次のホップに送信成功するまでキューからアイテムを消さない。
- シャドウ冗長に対応していないホストからのメール送信に関してはSMTPセッション中で送信完了を帰す前に先にNextHopに先にメールを送信し、その送信が完了するまで応答を返さない。
- ただ、あまりにも長く応答しないでいると送信もとがコネクションをきってしまうのでタイムアウト値がきめられており、それは規定で30秒になっている。

というわけで、システム全体でメール流量が多くなり、配送が遅延しているような時には外部からのSMTPセッションに対して30秒も遅延を入れてしまい、システム側でメール送信完了まで応答を返さないような仕組みになっていると問題が発生してしまう。

Exchange2010は色々と規定の状態での制限値が多すぎて困ったものです。トラブルを未然に防ぐために制限を意図的に入れているんだろうけど、はっきり言ってそんな制限無い方がトラブルになりません。Exchange Server 2010になって新しい制限値やSP1になって、SP2になっての新しい制限値にぶつかってトラブルになるたびにその制限値を外してる感じです。一体何のための制限値やら……。
