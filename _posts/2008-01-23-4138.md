---
title: "2008-01-23"
date: 2008-01-23
tags: 
  - "network"
---

#### OP25Bとは

- [サポート情報 お役立ち情報 OP25B　［迷惑メール送信規制］｜Yahoo! BBサービス](https://ybb.softbank.jp/support/utility/op25b/index.html)

""OP25Bとは ""迷惑メールの多くは、ご利用中のプロバイダーのメールサーバを経由せずに、直接送信されます。このような直接送信されるメールを阻止して、迷惑メールの送信を防止するのが、OP25B(Outbound Port25 Blocking)と呼ばれる対策です。 ""OP25Bは、外部からの不正アクセスやウイルス感染などによる「意図しない大量メールの送信」「パソコン内の個人情報の流出」などの防止にも力を発揮するため、有効な迷惑メール対策として国内のプロバイダー各社で導入が進んでいます。 ""Yahoo! BBでは、2006年8月より導入を開始いたしました。

- [サポート情報 お役立ち情報 OP25Bの実施スケジュール｜Yahoo! BBサービス](https://ybb.softbank.jp/support/utility/op25b/schedule.html)

""11月26日 月 千葉県／東京都(23区以外)／栃木県\*

というわけで、嫁から「メールが送信できない！」と苦情(?)を言われたので調べてみたらYahooBBのOP25Bが原因でした。丸々2ヶ月程度嫁がメールを外部に送信できていなかったようです。ごめんね嫁。自分はgmailがメインなので実害はなかったんだけど・・・。YahooBBから連絡来てないよ・・・。

#### 回避方法 - サブミッションポートでSMTP\_AUTH

回避方法を調べたところサブミッションポートで送信しろとのこと

- [サポート情報 困ったときは！ Yahoo! BB ADSLに関するよくあるご質問｜Yahoo! BBサービス](https://ybb.softbank.jp/support/faq/adsl/?category=43&id=49)

""ご使用のメールソフトのメール設定について、送信メールサーバー(SMTP)のポート番号を25番から587番へ変更していただきます。あわせてメール投稿者の認証のためのIDとパスワードも設定します。

OutlookExpressの場合の設定方法例はこちらに。ybbsmtp.mail.yahoo.co.jpの587番ポートにSMTP\_AUTHで送信してあげればよいようです。

- [サポート情報 困ったときは！ メール送信時にエラーが表示される（Microsoft Outlook Express 6）｜Yahoo! BBサービス](https://ybb.softbank.jp/support/trouble_shoot/other/mail_send/05.php)

というわけで、我が家ではpostfixくんがメールをさばいてくれていますのでpostfixからYahooBBのリレーサーバーのサブミッションポートにむけてSMTP\_AUTHを行ったうえで送信する必要があります。とりあえずぐーぐる先生に設定方法を聞いてみる。

問題とその対処の解説は以下のサイトがわかりやすかったです。

- [OP25B対策(Outbound Port 25 Blocking対策)](http://www.aconus.com/~oyaji/mail2/op25b.htm)

さらにYahooBBの場合は外部メールアドレスを登録してあげないといけないこともわかりました。

- [Yahoo!メール ヘルプ - メールソフトで差出人（From）を設定する際の注意](http://help.yahoo.co.jp/help/jp/mail/mailsoft/mailsoft-38.html)
- [Yahoo!メール ヘルプ - 外部メールを設定する](http://help.yahoo.co.jp/help/jp/mail/tips/tips-12.html)

こちらはWebから設定しました。

#### 具体的な設定方法

具体的な設定方法は以下のサイトを参考にさせてもらいました。

- [【Vine Linuxで自宅サーバー】PostfixでOutbound port 25 Blocking（OP25B）対策の設定](http://vine.1-max.net/postfix-OP25B.html)

```
emacs /etc/postfix/main.cf
```

でmain.cfに以下の設定を記述

```
relayhost = [ybbsmtp.mail.yahoo.co.jp]:587
```

```
smtp_sasl_auth_enable = yes
```

```
smtp_sasl_password_maps = hash:/etc/postfix/isp_auth
```

```
smtp_sasl_security_options = noanonymous
```

※ここで、smptd\_sasl\_xxxxxとsmtp\_sasl\_xxxxxの設定を混同して「SMTP\_AUTHで送信してくれない〜」とかなり悩んでしまいました。smtpdとsmtpは別物なので注意してください。main.cfにはsmtpd\_sasl〜ではなくsmtp\_sasl〜という設定をします。

```
emacs /etc/postfix/isp_auth
```

でisp\_authに以下のように記述。"account", "password"の部分にはYahooBBに登録した外部メールアドレスのアカウント名とパスワードを入力します。

```
[ybbsmtp.mail.yahoo.co.jp]:587 account:password
```

次にpostmapコマンドでpostfix用の検索テーブルを作成します。

```
postmap /etc/postfix/isp_auth
```

次に、postfixにSMTP-AUTHをしゃべらせるためにmaster.cfを編集します。

```
emacs /etc/postfix/master.cf
```

以下のように記述

```
smtp      inet  n       - - - - smtpd
```

```
submission inet n       - - - - smtpd
```

```
 -o smtpd_etrn_restrictions=reject
```

```
 -o smtpd_sasl_auth_enable=yes
```

```
 -o smtpd_client_restrictions=permit_sasl_authenticated,reject
```

※こちらはsmtpd\_〜という設定項目です。

設定が完了したらpostfixを再起動します。

```
 /etc/init.d/postfix restart
```

以上で設定完了。無事にメールが送信できるようになりました。結局メモを取りながら設定していたら2時間弱かかってしまいました。仕事をやろうと思っていたのに今日はこれに時間を使ってしまった・・・・。

でも、勉強になったので良いことにします。
