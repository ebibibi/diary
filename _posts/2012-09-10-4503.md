---
title: "2012-09-10"
date: 2012-09-10
tags: 
  - "emacs"
---

Macを使うようになって、エディタにいいものが無くて結局Emacsを導入したのですが、何年かぶりにEmacsを使ってみたらその良さに改めて感動してしまいました。というわけで、WindowsにもEmacsを導入しました。せっかく導入するので以下の事項を満たせるように頑張ってみました。

- どのWindows端末でも同じ環境で使える
- 1か所で設定を更新したら全部の環境に設定変更が反映される
- 素敵なフォントが使える
- Windows用必須アプリXKeymacsとの併用が可能

#### Emacsの導入

emacsは展開さえしてしまえば簡単に使い出せてしまうというgnupackの「emacs for gnupack」を利用しました。楽ちんでいいですね。

- [gnupack Users Guide - ダウンロード](http://gnupack.sourceforge.jp/docs/latest/UsersGuide_download.html#_download_emacs)

最新版はemacs 24.2(2012-09-02)でした。

展開先はDropboxで共有されているフォルダにしました。こうしておけばどのPCからでも利用できます。

#### Homeディレクトリの設定

Homeディレクトリ以下に.emacs.d等を配置しますので、これもemacs本体同様に同期させちゃいたいので以Windows上でHome環境変数をDropboxディレクトリ内に設定。これでemacsを利用するすべてのPCで同じように環境変数を設定してあげればOKになります。

#### Rictyの導入

##### Cygwinインストール

フォント自体の配布がなされておらず、生成しなくてはいけないのでまずはCygwinをインストールします。(面倒だな…。)

- [Cygwin Installation](http://cygwin.com/install.html)

Setup.exeを実行して既定のまま次へ次へと進めてみました。

##### FontForgeをCygwinにインストール

次にFontForgeをCygwinにインストール。Windowsにインストールするわけではない。cygwin用のパッケージが必要。最新版にはなさそうだったので、古いバージョンからcygwin用のものを見つけてきた。

- [FontForge -- An Outline Font Editor - Browse /fontforge-executables/oldReleases/20090923 at SourceForge.net](http://sourceforge.net/projects/fontforge/files/fontforge-executables/oldReleases/20090923/)

```
bunzip2 fontforge_cygwin-20090914.tar.bz2
```

```
tar xvf fontforge_cygwin-20090914.tar
```

```
cd fontforge
```

```
./doinstall
```

##### Iconsolataインストール

- [Inconsolata](http://levien.com/type/myfonts/inconsolata.html)

上記からOpenType fileをダウンロード。それをC:\\Windows\\Fontsにコピペしてインストール。

##### Migu 1M のインストール

- [M+とIPAの合成フォント](http://mix-mplus-ipa.sourceforge.jp/)

上記からMigu 1Mをダウンロード。Zipを展開し、migu-1m-regular.ttf migu-1m-bold.ttfをインストール。

##### Rictyの生成

- [yascentur/Ricty at 3.2.0](https://github.com/yascentur/Ricty/tree/3.2.0)

現在最新版の上記より、ricty\_generator.shをダウンロード。cygwin上でスクリプトを実行。

```
ricty_generator.sh auto
```

と、ここで以下のエラー

```
$ ./ricty_generator.sh auto
```

```
Ricty Generator 3.2.1b
```

どうやらよくわかってなかったけれど、fc-cacheコマンドでフォントの登録を行っておかないといけない野かな? でもそのコマンドが無くてどこで構成できるのかわからなかった。適当にcygwinのsetupから「fontconfig」を選んでみる。 fc-cacheコマンドはこれで入った。

```
fc-cache -fv
```

fc-listで目的のフォントが入っており、認識されることも確認。でも、同じエラーでフォントの生成はできない。

詳細表示させてみたところ、cygxml2-2.dllが無いそうな。

```
$ ./ricty_generator.sh -v auto
```

```
Ricty Generator 3.2.1b
```

cygwinのSetupにてLibs以下のlibxml2をインストールすれば解消された。

```
/usr/local/bin/fontforge.exe: error while loading shared libraries: cygpng12.dll: cannot open shared object file: No such file or directory
```

次は上記のエラー。同様にlibpng12をインストール。libpng12はobsoleteだったので、「Hide obsolete packages」のチェックを外さないといけなかった。

```
/usr/local/bin/fontforge.exe: error while loading shared libraries: cygX11-6.dll: cannot open shared object file: No such file or directory
```

次はこれ…。そうですか…やっぱりX関連のパッケージは入れておかないといけなかったんですね…涙。今までのもそうなんだろうなーと思いながらもうめんどくさくなったので、X11を根っこからインストール選択。(フォント生成したいだけなのになぁ…。)これできちんとフォントを生成できました。

```
fc-cache -fv
```

で、一応cygwinに取り込んでおきます。

#### gdipp導入

- [Downloads - gdipp - Customizable Windows text renderers - Google Project Hosting](http://code.google.com/p/gdipp/downloads/list)

上記から0.7.6 Stableを導入。導入する理由はきちんとアンチエイリアスがかからないから…。

#### Emacsへのフォント設定

```
(add-to-list 'default-frame-alist '(font . "ricty-12"))
```

~/.emacs.d/init.elに上記のように記述してフォントを適用しました。いい感じになった!

#### Xkeymacsとのバッティングを回避する。

Emacsが使えるようになりましたが、Windowsユーザー必須ソフトのXkeymacsがEmacs上で有効になってしまい、きちんと動作しません。かなり困ってしまったのですが回避策があることをTwitterで教えてもらいました。

> @[ebi](https://twitter.com/ebi) こちらのチケットを参照してください。 [sourceforge.jp/ticket/browse.…](http://t.co/Al0faPqm "http://sourceforge.jp/ticket/browse.php?group_id=716&tid=23955")
> 
> — 藤枝和宏さん (@kfujieda) [9月 10, 2012](https://twitter.com/kfujieda/status/245013601449021440)

[//platform.twitter.com/widgets.js](//platform.twitter.com/widgets.js)

最新版に上げても私の環境ではうまく動作しなかったので、IMEに対してXkeymacsを無効に設定することで問題回避できました。これでずいぶんと幸せになれそうな気がします。

#### 参考にさせてもらったもの

- [プログラミングに最適な Ricty フォントを生成してインストールする - In my secretbase](http://d.hatena.ne.jp/cointoss1973/20110907/1315408385)
- [FontForge の cygwin (MS-Windows) へのインストール手順](http://fontforge.org/ja/ms-install.html)
- [emacs での Ricty の導入手順 - わからん](http://d.hatena.ne.jp/kitokitoki/20110502/p2)
