---
title: "日記ブログをお引越ししました。"
date: 2021-09-11
categories: 
  - "tech"
tags: 
  - "latin1"
  - "mysql"
  - "utf8"
  - "wordpress"
  - "文字化け"
---

随分と更新しなくなってしまったこの日記ブログですが、ふと思い立ってVMからAzure PaaSへとお引越ししました。もうVMの管理をしなくて良いように、完全に個人サイト関連はVMを捨てます。

移行は簡単に終わる予定でしたが、MySQLで文字化けが発生…。どうやら前回VMを引っ越した際にDBのcharset設定をミスしていたようです。latin1の中にUTF8で文字が書かれているという謎な状態になってしまっていました。

ちょっと苦労したのですが結局下記の手順で移行しました。

1. character-setを変更せずにそのままmysqldumpでダンプする。  
    mysqldump -u user -p --default-character-set=latin1 wp\_database > wp\_database.dump
2. 「latin1」という文字を「utf8」に置換する。  
    sed -e s/latin1/utf8/ wp\_database.dump > wp\_database\_utf8.dump
3. 「latin1\_general\_cs」という文字を「utf8\_general\_ci」に置換する。  
    sed -e s/latin1\_general\_cs/utf8\_general\_ci/ wp\_database\_utf8.dump > wp\_database\_utf8\_general\_ci.dump
4. 新しいdatabaseに取り込む。  
    mysql --host=newmysqldbname.mysql.database.azure.com --user=user -p wp\_database < wp\_database\_utf8\_general\_ci.dump

というわけで、新しい環境にお引越しが一応うまく行った感じです。

もう日記サイトをわざわざ見に来るひともめったにいなくなったと思いますが、新しいWordpressならブログの内容をtwitterに自動連投できるようなのでそれを使おうと思います。まる。
