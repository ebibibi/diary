---
title: "2009-01-29"
date: 2009-01-29
tags: 
  - "debian"
---

今日は時間があるので会社の勉強会のための資料を作成しよう・・・と思ってデータ取りのために自宅のサーバーにログインしたうえでrootになろうとしたら・・・なれませんでした(泣。

wで確認したらtestというアカウントで89.35.82.169からsshでアクセスが。完全にやられてしまいました。数日前にデータ取りのために仮のアカウントを作成していたのですが以下の点で迂闊でした。

- アカウント名が安易過ぎた
- パスワードが安易過ぎた
- sshの接続元を絞っていなかった
- sshにパスワード認証を使っていた

もう再インストールすることは覚悟したのですが、データ復旧なり、現在どうなっているかを知りたいのでsudo passwd rootを実行してみたところrootのパスワードの書き換えには成功。

以下の方針で復旧します。

- USBHDDをつないで現在のシステムから必要な部分のバックアップを取得

まずはUSBHDDの接続

- 接続。自動認識される。
- dmesgにて/dev/sdaとして認識されたことを確認
- fdisk /dev/sdaでパーティション作成
- mke2fs -j /dev/sda1でext3のファイルシステムを作成
- mkdir /mnt/usbhdd; mount -t ext3 /dev/sda1 /mnt/usbhddでマウント

必要なものをバックアップ

- /etc/init.d/mysql stop
- /etc/init.d/apache2 stop
- cp -aux 必要なもの /mnt/usbhdd

新規インストール〜リストア

- netinst CDブート
- インストール
- 必要なパッケージのインストール
- 必要なデータ、設定ファイル等のリストア

というわけで、復旧いたしました。数日間繋がらなくなっていたのはこれが原因です。

それにしても、設定ファイルとか書き戻してあげれば簡単に復旧できちゃうんだから、UNIX系OSはすごいよなぁ。Windowsとは大違いだよなぁ・・・。
