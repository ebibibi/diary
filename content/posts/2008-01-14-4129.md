---
title: "2008-01-14"
date: 2008-01-14
tags: 
  - "vmware"
---

VMware Playerを使って無料で仮想環境を構築する方法のまとめです。

#### 提供されているイメージを使う方法

VMware Playerで仮想マシンを新規に作成することはできないため配布されているOSイメージを用いることで利用を開始します。

とりあえず以下で大量に配布されているのでまずここで探すとよいでしょう。

- [Virtual Appliance Marketplace, Virtual Appliances, VMware Appliance - VMware](http://www.vmware.com/appliances/)

#### 新規に仮想マシンを構築する方法

本来はできないことになっているのですが、色々とテクニックを駆使することで事実上新規に仮想マシンを作成するのと同じことができてしまいます。

具体的な方法の紹介は以下の2つの記事に譲ります。

- [μ memo: VMware Playerのみで新しいVirtualMachineを構築する](http://blog.yasaka.com/archives/2005/10/vmware_playervi.html)
- [ITmedia エンタープライズ：VMware Playerを用いたイメージの作成法](http://www.itmedia.co.jp/enterprise/articles/0606/20/news036.html)

基本的には一度最小限の雛形を作成してしまえば、後は毎回その雛形を元にしてインストールすればいいだけなので、一度だけがんばればあとは非常に楽です。雛形を公開するとライセンス的に問題がある気がするので、公開は控えておきます。

#### VMwareで作成したWindowsマシンを簡単に使いまわす方法

VMwareで作成した仮想マシンはフォルダをコピーするだけで非常に簡単に複製することができます。これをつかって、一度ベースとなる仮想マシンを作成しておき、あとはそれをコピーした上で違うソフトウェアを導入するようなことができます。

ですがこれをWindowsマシンで実施する場合には注意が必要です。WindowsマシンにはSIDが埋め込まれており、これが重複するとうまく動かないケースが出てきます。これは特にVMwareでActiveDirectory環境を構築するような場合に重要になってきます。

このようなときには一度ベースとなる仮想マシンを作成した後にSIDを変更するツールを使ってSIDを変更しつつ複製するのが有効です。無償でこれが行えるツールとしては以下の2つが有名です。

- sysprep

- [＠IT：Windows TIPS -- Tips：sysprepで環境複製用のマスタ・イメージを作成する](http://www.atmarkit.co.jp/fwin2k/win2ktips/553sysprep/sysprep.html)

- NewSID

- [NewSID v4.10](http://technet.microsoft.com/en-us/sysinternals/bb897418.aspx?wt.svl=leftnav.aspx?wt.svl=leftnav)

#### VMTools

VMToolsはVMwareの仮想マシンにインストールして動作を軽快にしたり、Drag & Dropを有効にしたり、時刻同期をホストマシンと取れるようにする便利なツールです。VMWare Playerには同梱されていませんが、体験版のVMWare Workstationから取得したものをインストールして利用することができます。ライセンス的にも問題ないとの事です。

#### VMwareでMSCSを構築する方法

VMwareのホストOSを2台用意し、それらをMSCSとして構成することができます。具体的には以下のように構成ファイルを記述すればOKです。

```
disk.locking = false 
```

```
scsi1.present = "TRUE"
```

```
scsi1:0.present = "TRUE"
```

```
scsi1:0.fileName = "vmdkファイルへのパス" 
```

```
scsi1:0.mode = "independent-persistent"
```

```
scsi1:0.deviceType = "plainDisk"
```

このように記述することで、2台のサーバーから同時に1つのHDDを見ることで、クラスタが実現できます。ただしVMWareToolsのSCSIドライバのインストールが必要なので、事前にインストールしておく必要があります。

#### 参考サイト

- [VM/VMware/VMware Player - SyncHack](http://mcn.oops.jp/wiki/index.php?VM%2FVMware%2FVMware%20Player)
- [VMwareで作る、初めてのLAMP環境構築 - Unix的なアレ](http://d.hatena.ne.jp/wadap/20080112/1200158744)
- [VMware Workstation 4.5.1 で Windows クラスタ（MSCS）](http://blogs.sqlpassj.org/matu_tak/archive/2004/05/13/2153.aspx)
