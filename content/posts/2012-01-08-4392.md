---
title: "2012-01-08"
date: 2012-01-08
tags: 
  - "linux"
---

自宅サーバーがうるさくて娘が夜寝る時にかわいそうなので、さくらVPSにお引越しすることにしました。以下移行メモ。

{{'

```
■OSインストール
とりあえずOSインストール

■Testingにする
apt-get install emacs
emacs /etc/apt/sources.list
   testingに書き換える
apt-get update; apt-get dist-upgrade;

■使用するpackageを導入する
apt-get install ssh -y

apt-get install wordpress -y
apt-get install postfix -y
apt-get install apache2 -y
apt-get install subversion -y
apt-get install mysql-server -y
apt-get install dokuwiki -y
apt-get install tdiary -y
apt-get install rsync
apt-get install libapache2-svn
apt-get install libapache2-mod-wsgi
apt-get install thin
apt-get install ruby-gems
apt-get install build-essential
apt-get install libxml2-dev
apt-get install libxslt-dev
apt-get install libmysqlclient-dev
apt-get install erubis
apt-get install python-setuptools
apt-get install python-django
apt-get install python-mysqldb
apt-get purge exim4

■rubygems
gem install sinatra
gem install haml
gem install sequel
gem install nokogiri
gem install mechanize
gem install mysql
gem install twitter
gem install oauth
gem install json

■python
easy_install South django django-debug-toolbar markdown html5lib python-openid

■移行元サーバーのサービスを止める
/etc/init.d/apache2 stop
/etc/init.d/mysql stop

■rsyncで同期する(移行元で実行)
rsync -avz -e ssh --delete /etc/ssh/ 49.212.123.45:/etc/ssh/
rsync -avz -e ssh --delete /etc/wordpress/ 49.212.123.45:/etc/wordpress/
rsync -avz -e ssh --delete /etc/postfix/ 49.212.123.45:/etc/postfix/
rsync -avz -e ssh --delete /etc/apache2/ 49.212.123.45:/etc/apache2/
rsync -avz -e ssh --delete /etc/subversion/ 49.212.123.45:/etc/subversion/
rsync -avz -e ssh --delete /etc/mysql/ 49.212.123.45:/etc/mysql/
rsync -avz -e ssh --delete /etc/my.cnf 49.212.123.45:/etc/my.cnf
rsync -avz -e ssh --delete /etc/dokuwiki/ 49.212.123.45:/etc/dokuwiki/
rsync -avz -e ssh --delete /etc/iptables/ 49.212.123.45:/etc/iptables/
rsync -avz -e ssh --delete /etc/php5/ 49.212.123.45:/etc/php5/

rsync -avz -e ssh --delete /usr/share/wordpress/ 49.212.123.45:/usr/share/wordpress/
rsync -avz -e ssh --delete /usr/share/tdiary/ 49.212.123.45:/usr/share/tdiary/
rsync -avz -e ssh --delete /usr/share/dokuwiki/ 49.212.123.45:/usr/share/dokuwiki/

rsync -avz -e ssh --delete /var/www/ 49.212.123.45:/var/www/
rsync -avz -e ssh --delete /var/svn/ 49.212.123.45:/var/svn/

rsync -avz -e ssh --delete /var/lib/mysql/ 49.212.123.45:/var/lib/mysql/
rsync -avz -e ssh --delete /var/lib/dokuwiki/ 49.212.123.45:/var/lib/dokuwiki/

rsync -avz -e ssh --delete /home/ebi/ 49.212.123.45:/home/ebi/
rsync -avz -e ssh /etc/cron.d/hateburanking 49.212.123.45:/etc/cron.d/hateburanking
rsync -avz -e ssh /etc/cron.d/rss_twit 49.212.123.45:/etc/cron.d/rss_twit
rsync -avz -e ssh /etc/cron.d/twitter2diary 49.212.123.45:/etc/cron.d/twitter2diary
rsync -avz -e ssh /etc/init.d/hateburanking 49.212.123.45:/etc/init.d/hateburanking
rsync -avz -e ssh /etc/init.d/hatebunow 49.212.123.45:/etc/init.d/hatebunow

■起動設定(移行先マシンにて)
update-rc.d hateburanking defaults 20
update-rc.d hatebunow defaults 20

■IPアドレス変更に伴う書き換え
emacs /etc/mysql/my.cnf
emacs /etc/apache2/sites-enabled/*

```

'}}
